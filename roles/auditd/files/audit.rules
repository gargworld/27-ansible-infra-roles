###
### Control Settings
###

# Clear out old configuration
-D

# Make the configuration immutable -- reboot is required to change audit rules
-e 2

# Update buffer size
-b 16384

# Print error on failure (do not panic)
-f 1

# Continue loading rules if a rule is unsupported or contains a syntax error; report error at end
-c

# Make the loginuid immutable.  Prevents tampering with auid.
#--loginuid-immutable

###
### Filter out noisy logs
###
-a never,user -F subj_type=crond_t

# early out on successful opens made by unset user or system users.
-a never,exit -F arch=b32 -S creat -S open -S openat -S open_by_handle_at -S pipe -S mknod -F success=1 -F auid<1000       -k exclude
-a never,exit -F arch=b64 -S creat -S open -S openat -S open_by_handle_at -S pipe -S mknod -F success=1 -F auid<1000       -k exclude
-a never,exit -F arch=b32 -S creat -S open -S openat -S open_by_handle_at -S pipe -S mknod -F success=1 -F auid=4294967295 -k exclude
-a never,exit -F arch=b64 -S creat -S open -S openat -S open_by_handle_at -S pipe -S mknod -F success=1 -F auid=4294967295 -k exclude

###
### Audit Rules
###

# Audit logon (unsuccessful and successful) and logout (successful)
-w /bin/login -p x -k file_login
-w /bin/logout -p x -k file_logout
-a always,exit -F path=/usr/bin/rsh -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/rlogin -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/rcp -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/dnf -F auid>=1000 -F auid!=unset -k privileged


# Audit Discretionary Access Control Permission Modification (successful and unsuccessful)
-a always,exit -F arch=b32 -S chmod -S chown -S fchmod -S fchown -S fchmodat -S fchownat -S lchown  -F auid=0 -k perm_mod
-a always,exit -F arch=b64 -S chmod -S chown -S fchmod -S fchown -S fchmodat -S fchownat -S lchown  -F auid=0 -k perm_mod
#-a always,exit -F arch=b32 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid=0 -k perm_mod
#-a always,exit -F arch=b64 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid=0 -k perm_mod
-a always,exit -F arch=b32 -S chmod -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S chmod -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S chown -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S chown -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fchmod -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S fchmod -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fchown -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S fchown -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S lchown -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S lchown -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fchmodat -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S fchmodat -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fchownat -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S fchownat -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fremovexattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S fremovexattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fremovexattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b64 -S fremovexattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b32 -S removexattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S removexattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S removexattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b64 -S removexattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b32 -S lremovexattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S lremovexattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S lremovexattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b64 -S lremovexattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b32 -S lsetxattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S lsetxattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S lsetxattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b64 -S lsetxattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b32 -S setxattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S setxattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S setxattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b64 -S setxattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b32 -S fsetxattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b64 -S fsetxattr -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S fsetxattr -F auid=0 -F -k perm_mod
-a always,exit -F arch=b64 -S fsetxattr -F auid=0 -F -k perm_mod
-a always,exit -F path=/usr/bin/chcon -F perm=x -F auid>=1000 -F auid!=unset -k perm_mod

# Unauthorized access attempts to files (unsuccessful)
-a always,exit -F arch=b32 -S pipe -S mknod -F exit=-EACCES -F auid>=1000 -F auid!=4294967294
-a always,exit -F arch=b32 -S pipe -S mknod -F exit=-EPERM -F auid>=1000 -F auid!=4294967294
-a always,exit -F arch=b64 -S pipe -S mknod -F exit=-EACCES -F auid>=1000 -F auid!=4294967294
-a always,exit -F arch=b64 -S pipe -S mknod -F exit=-EPERM -F auid>=1000 -F auid!=4294967294
#-a always,exit -F arch=b32 -S creat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b32 -S creat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S creat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S creat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
-a always,exit -F arch=b32 -S creat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b32 -S creat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S creat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S creat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
#-a always,exit -F arch=b32 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b32 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
-a always,exit -F arch=b32 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b32 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S open -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S open -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
#-a always,exit -F arch=b32 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b32 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
-a always,exit -F arch=b32 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b32 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S openat -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S openat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access

#-a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
-a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b32 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S open_by_handle_at -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access

#-a always,exit -F arch=b32 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b32 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
-a always,exit -F arch=b32 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b32 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access

#-a always,exit -F arch=b32 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b32 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access
#-a always,exit -F arch=b64 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access
-a always,exit -F arch=b32 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b32 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S truncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k perm_access
-a always,exit -F arch=b64 -S truncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k perm_access

# Privileged commands (unsuccessful and successful)
-w /usr/sbin/pwck -k priv_cmd
-a always,exit -F path=/usr/sbin/pwck -F perm=x -F auid>=1000 -F auid!=unset -F key=priv_cmd

# User and Group related commands
-a always,exit -F path=/usr/bin/chgrp -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/lnewgrp -F perm=x -F auid>=1000 -F auid!=unset -k user_group
#-a always,exit -F path=/usr/bin/newgrp -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/bin/newgrp -F perm=x -F auid>=1000 -F auid!=unset -k priv_cmd
-a always,exit -F path=/usr/sbin/groupadd -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/groupmod -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/groupdel -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/luseradd -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/useradd -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/luserdel -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/userdel -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/lusermod -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/usermod -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/usermod -F perm=x -F auid>=1000 -F auid!=unset -k privileged-usermod
-a always,exit -F path=/usr/sbin/lnewusers -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/newusers -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/lchage -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/chage -F auid>=1000 -F auid!=unset -k privileged-passwd
-a always,exit -F path=/usr/bin/chage -F auid>=1000 -F auid!=unset -k privileged-passwd
-a always,exit -F path=/usr/sbin/lpasswd -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/passwd -F auid>=1000 -F auid!=unset -k user_group
#-a always,exit -F path=/usr/bin/passwd -F auid>=1000 -F auid!=unset -k privileged-passwd
-a always,exit -F path=/usr/bin/passwd -F perm=x -F auid>=1000 -F auid!=unset -k privileged-passwd
-a always,exit -F path=/usr/sbin/gpasswd -F auid>=1000 -F auid!=unset -k privileged-passwd
#-a always,exit -F path=/usr/bin/gpasswd -F auid>=1000 -F auid!=unset -k privileged-passwd
-a always,exit -F path=/usr/bin/gpasswd -F perm=x -F auid>=1000 -F auid!=unset -k privileged-gpasswd

-a always,exit -F path=/usr/sbin/vipw -F perm=x -F auid>=1000 -F auid!=unset -k user_group
-a always,exit -F path=/usr/sbin/visudo -F perm=x -F auid>=1000 -F auid!=unset -k user_group

-a always,exit -F path=/usr/bin/ldapadd -F perm=x -F auid>=1000 -F auid!=unset -k ldap
-a always,exit -F path=/usr/bin/ldapmodify -F perm=x -F auid>=1000 -F auid!=unset -k ldap
-a always,exit -F path=/usr/bin/ldapdelete -F perm=x -F auid>=1000 -F auid!=unset -k ldap
-a always,exit -F path=/usr/bin/ldappasswd -F perm=x -F auid>=1000 -F auid!=unset -k ldap
-a always,exit -F path=/usr/bin/ldapexop -F perm=x -F auid>=1000 -F auid!=unset -k ldap
-a always,exit -F path=/usr/bin/ldapmodrdn -F perm=x -F auid>=1000 -F auid!=unset -k ldap

-a always,exit -F path=/usr/bin/setfacl -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/setfacl -F perm=x -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F path=/usr/bin/chacl -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/chacl -F perm=x -F auid>=1000 -F auid!=unset -k perm_mod
-a always,exit -F arch=b32 -S chroot -k priv_cmd
-a always,exit -F arch=b64 -S chroot -k priv_cmd

# Files and programs deleted by the user (successful and unsuccessful)
-a always,exit -F arch=b32 -S link -S symlink -F auid>=1000 -F auid!=unset -k file_delete
-a always,exit -F arch=b64 -S link -S symlink -F auid>=1000 -F auid!=unset -k file_delete
-a always,exit -F arch=b32 -S unlink -S unlinkat -S rmdir -S rename -S renameat -S link -S symlink -F auid=0 -k file_delete
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rmdir -S rename -S renameat -S link -S symlink -F auid=0 -k file_delete
-a always,exit -F arch=b32 -S unlink -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b64 -S unlink -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b32 -S unlinkat -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b64 -S unlinkat -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b32 -S rmdir -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b64 -S rmdir -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b32 -S rename -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b64 -S rename -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b32 -S renameat -F auid>=1000 -F auid!=unset -k delete
-a always,exit -F arch=b64 -S renameat -F auid>=1000 -F auid!=unset -k delete

# Other commands to monitor
-a always,exit -F path=/usr/bin/write -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/pkexec -F auid>=1000 -F auid!=unset -k privileged
#-a always,exit -F path=/usr/sbin/pam_timestamp_check -F auid>=1000 -F auid!=unset -k privileged-pam
#-a always,exit -F path=/usr/sbin/unix_chkpwd -F auid>=1000 -F auid!=unset -k privileged-passwd
#-a always,exit -F path=/usr/sbin/semanage -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/sbin/usernetctl -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/ccreds_validate -F auid>=1000 -F auid!=unset -k privileged
#-a always,exit -F path=/usr/sbin/userhelper -F auid>=1000 -F auid!=unset -k privileged-passwd
-a always,exit -F path=/usr/sbin/netreport -F auid>=1000 -F auid!=unset -k privileged
#-a always,exit -F path=/usr/sbin/postdrop -F auid>=1000 -F auid!=unset -k privileged-postfix
#-a always,exit -F path=/usr/sbin/postqueue -F auid>=1000 -F auid!=unset -k privileged-postfix
-a always,exit -F path=/usr/lib/polkit-1/polkit-agent-helper-1 -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/libexec/dbus-1/dbus-daemon-launch-helper -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/libexec/utempter/utempter -F perm=x -F auid>=1000 -F auid!=unset
#-a always,exit -F path=/usr/libexec/openssh/ssh-keysign -F auid>=1000 -F auid!=unset -k privileged-ssh
-a always,exit -F path=/usr/bin/ssh-agent -F perm=x -F auid>=1000 -F auid!=unset -k privileged-ssh
-a always,exit -F path=/usr/bin/Xorg -F perm=x -F auid>=1000 -F auid!=unset
-a always,exit -F path=/usr/bin/at -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/curl -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/wget -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/kgrantpty -F auid>=1000 -F auid!=unset -k privileged
#-a always,exit -F path=/usr/bin/crontab -F auid>=1000 -F auid!=unset -k privileged-cron
-a always,exit -F path=/usr/bin/staprun -F auid>=1000 -F auid!=unset -k privileged
#-a always,exit -F path=/usr/bin/chsh -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/bin/chfn -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/chcon -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/bin/newrole -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/kpac_dhcp_helper -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/wall -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/ssh-agent -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/bin/mkdir -F auid!=unset -k Directory_Create
-a always,exit -F path=/bin/rm -F auid!=unset -k File_or_Directory_Delete
#-a always,exit -F path=/usr/sbin/setsebool -F auid>=1000 -F auid!=unset -k privileged-priv_change
#-a always,exit -F path=/usr/sbin/setfiles -F auid>=1000 -F auid!=unset -k privileged-priv_change
#-a always,exit -F arch=b32 -S execve -C uid!=euid -F euid=0 -k setuid
#-a always,exit -F arch=b64 -S execve -C uid!=euid -F euid=0 -k setuid
#-a always,exit -F arch=b32 -S execve -C gid!=egid -F egid=0 -k setgid
#-a always,exit -F arch=b64 -S execve -C gid!=egid -F egid=0 -k setgid
-a always,exit -F arch=b32 -S execve -C uid!=euid -F euid=0 -k execpriv
-a always,exit -F arch=b64 -S execve -C uid!=euid -F euid=0 -k execpriv
-a always,exit -F arch=b32 -S execve -C gid!=egid -F egid=0 -k execpriv
-a always,exit -F arch=b64 -S execve -C gid!=egid -F egid=0 -k execpriv
-a always,exit -F path=/usr/bin/fusermount -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/locate -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/screen -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/libexec/utempter/utempter -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/restorecon -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/sbin/cupsd -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/sbin/pwck -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/unix_update -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/postdrop -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/postqueue -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/semanage -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/setfiles -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/userhelper -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/setsebool -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/sbin/unix_chkpwd -F perm=x -F auid>=1000 -F auid!=unset -k privileged-unix-update
-a always,exit -F path=/usr/libexec/openssh/ssh-keysign -F perm=x -F auid>=1000 -F auid!=unset -k privileged-ssh
-a always,exit -F path=/usr/sbin/pam_timestamp_check -F perm=x -F auid>=1000 -F auid!=unset -k privileged-pam_timestamp_check
-a always,exit -F path=/usr/bin/crontab -F perm=x -F auid>=1000 -F auid!=unset -k privileged-crontab
-a always,exit -F path=/usr/bin/chsh -F perm=x -F auid>=1000 -F auid!=unset -k priv_cmd

# Monitor vault files and root dir
-w /service_home/vault/ -p war -k vault
-w /root/ -p rwa -k testing_policy

# Monitor Audit and Logging
-w /etc/audit/ -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/audit/ -p wa -k audit
-w /etc/audit/audit.rules -p wa -k audit_policy
-w /etc/audit/auditd.conf -p wa -k audit_policy
-w /etc/audit/audit.d/ -p wa -k audit_policy
-w /etc/syslog-ng/ -p wa -k audit_policy
-w /etc/libaudit.conf -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/sysconfig/auditd -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/selinux/ -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/audisp/ -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/logrotate.conf -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/logrotate.d/ -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/security/ -p wa -k SEC_AUDIT_POLICY_CHANGE



# Other logs
-w /var/log/messages -p wa -k logging
-w /var/log/sudo.log -p wa -k actions
-w /etc/rsyslog.conf -p wa -k CONF_CHANGE

# Monitor items related to MAC policy
-w /var/log/lastlog -p wa -k logins
#w /var/run/faillock -p wa -k logins
-w /var/log/faillock -p wa -k logins
-w /etc/security/faillock.conf -p wa -k CONF_CHANGE
-w /var/log/tallylog -p wa -k logins
-w /usr/share/selinux/ -p wa -k MAC-policy
-w /var/log/faillog -p wa -k logins

# Monitor process/session initiation
-w /var/run/utmp -p wa -k session
-w /var/log/btmp -p wa -k logins
-w /var/log/wtmp -p wa -k logins


# Monitor user identity configs
-w /etc/passwd -p wa -k identity
-w /etc/shadow -p wa -k identity
-w /etc/group -p wa -k identity
-w /etc/gshadow -p wa -k identity
-w /etc/security/opasswd -p wa -k identity
-w /etc/sudoers -p wa -k identity
-w /etc/sudoers.d/ -p wa -k identity

-w /etc/ld.so.conf -p wa -k CONF_CHANGE
-w /etc/ssh/sshd_config -p wa -k SEC_AUDIT_POLICY_CHANGE

# Monitor PAM and auth configuration
-w /etc/nsswitch.conf -p wa -k CONF_CHANGE
-w /etc/pam.d/ -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/pam.d -k system_file
-w /etc/pam.d/gdm -k system_file
-w /etc/pam.d/login -k system_file
-w /etc/pam.d/passwd -k system_file
-w /etc/pam.d/sshd -k system_file
-w /etc/pam.d/system-auth -k system_file
-w /etc/pam.d/su -k system_file
-w /etc/pam.d/sudo -k system_file


# Monitor system init items-w /etc/rc.d/init.d -k system_file
-w /etc/inittab -p wa -k CONF_CHANGE

# Monitor login configuration
-w /etc/login.defs -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/securetty -p wa -k SEC_AUDIT_POLICY_CHANGE
-w /etc/resolv.conf -p wa -k CONF_CHANGE

# Sysadmin actions
-a always,exit -F arch=b32 -S acct -S swapon -k sys_admin
-a always,exit -F arch=b64 -S acct -S swapon -k sys_admin


# Monitor Role/Privilege Escalation
#-w /etc/sudoers -p wa -k privileged-actions
#-w /etc/sudoers.d/ -p wa -k privileged-actions
#-a always,exit -F path=/usr/bin/su -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/bin/su -F perm=x -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/bin/su -F auid>=1000 -F auid!=unset -k priv_escalation
#-a always,exit -F path=/usr/bin/sudo -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/bin/sudo -F perm=x -F auid>=1000 -F auid!=unset -k privileged-priv_cmd
-a always,exit -F path=/etc/pam.d/su -F perm=x -F auid>=1000 -F auid!=unset -k priv_escalation
-a always,exit -F path=/etc/pam.d/sudo -F perm=x -F auid>=1000 -F auid!=unset -k priv_escalation
-a always,exit -F path=/usr/sbin/suexec -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/bin/sudoedit -F perm=x -F auid>=1000 -F auid!=unset -k privileged-priv_change
-a always,exit -F path=/usr/bin/chage -F perm=x -F auid>=1000 -F auid!=unset -k privileged-priv_chage

# Monitor time configuration
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
-a always,exit -F arch=b32 -S clock_settime -k time-change
-a always,exit -F arch=b64 -S clock_settime -k time-change
-w /etc/localtime -p wa -k time-change

# Monitor system-locale configuration
-a always,exit -F arch=b32 -S sethostname -S setdomainname -k CONF_CHANGE
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k CONF_CHANGE
-w /etc/issue -p wa -k CONF_CHANGE
-w /etc/issue.net -p wa -k CONF_CHANGE
-w /etc/hosts.allow -p wa -k system-locale
-w /etc/hosts.deny -p wa -k system-locale
-w /etc/sysconfig/network -p wa -k CONF_CHANGE
-a always,exit -F dir=/etc/NetworkManager/ -F perm=wa -F key=system-locale


# Monitor SW package installs
#-w /usr/bin/yum -p wa -k CONF_CHANGE
-w /etc/yum.conf -p wa -k CONF_CHANGE
-w /usr/sbin/rpm -p wa -k CONF_CHANGE
-w /etc/aide.conf -p wa -k CONF_CHANGE
-w /etc/dnf/dnf.conf -p wa -k CONF_CHANGE
-w /etc/audisp/audisp-remote.conf -p wa -k CONF_CHANGE
-a always,exit -F path=/usr/bin/yum -F auid>=1000 -F auid!=unset -k privileged
-a always,exit -F path=/usr/sbin/rpm -F auid>=1000 -F auid!=unset -k privileged

# Monitor kernel configuration
-w /etc/sysctl.conf -p wa -k CONF_CHANGE
-w /etc/modprobe.d/ -p wa -k CONF_CHANGE

# Monitor system state changes
-a always,exit -F arch=b32 -S reboot -F auid!=unset -k system_state
# removed shutdown. Not in disa stigs and excessive use by oracle.
# note: shutdown system call is a socket shutdown, not system.
#-a always,exit -F arch=b64 -S shutdown -S reboot -F auid!=unset -k system_state
-a always,exit -F arch=b64              -S reboot -F auid!=unset -k system_state
-w /sbin/shutdown -p x -k power
-w /sbin/reboot -p x -k power
-w /sbin/poweroff -p x -k power
-w /sbin/halt -p x -k power


# Monitor mounts/unmounts (successful and unsuccessful)
#-a always,exit -F path=/usr/bin/mount -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F path=/usr/bin/mount -F perm=x -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F arch=b32 -F path=/bin/mount -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F arch=b64 -F path=/bin/mount -F auid>=1000 -F auid!=unset -k privileged-mount
#-a always,exit -F path=/usr/bin/umount -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F path=/usr/bin/umount -F perm=x -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F path=/usr/sbin/mount.nfs -F auid>=1000 -F auid!=unset -k privileged

# Monitor media exports (successful)
-a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=unset -k export
-a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=unset -k export
-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F arch=b32 -S mount -F auid=0 -k export
-a always,exit -F arch=b64 -S mount -F auid=0 -k export

-a always,exit -F arch=b32 -S umount2 -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F arch=b64 -S umount2 -F auid>=1000 -F auid!=unset -k privileged-mount
-a always,exit -F arch=b32 -S mount -S umount2 -F auid=0 -k privileged-mount
-a always,exit -F arch=b64 -S mount -S umount2 -F auid=0 -k privileged-mount

# Monitor module insertion
-w /sbin/insmod -p x -k modules
-w /sbin/rmmod -p x -k modules
-w /sbin/modprobe -p x -k modules
#-w /usr/bin/kmod -p x -F auid!=unset -k module-change
-a always,exit -F path=/usr/bin/kmod -F perm=x -F auid>=1000 -F auid!=unset -k modules
#-a always,exit -F arch=b32 -S delete_module -k module-change
#-a always,exit -F arch=b64 -S delete_module -k module-change
-a always,exit -F arch=b32 -S delete_module -F auid>=1000 -F auid!=unset -k module_chng
-a always,exit -F arch=b64 -S delete_module -F auid>=1000 -F auid!=unset -k module_chng
-a always,exit -F arch=b32 -S init_module -S delete_module -k modules
-a always,exit -F arch=b64 -S init_module -S delete_module -k modules
#-a always,exit -F arch=b32 -S finit_module -k module-change
#-a always,exit -F arch=b64 -S finit_module -k module-change
-a always,exit -F arch=b32 -S finit_module -F auid>=1000 -F auid!=unset -k module_chng
-a always,exit -F arch=b64 -S finit_module -F auid>=1000 -F auid!=unset -k module_chng
-a always,exit -F arch=b32 -S create_module -k module-change
-a always,exit -F arch=b64 -S create_module -k module-change
#-a always,exit -F arch=b32 -S init_module -k module-change
#-a always,exit -F arch=b64 -S init_module -k module-change
-a always,exit -F arch=b32 -S init_module -F auid>=1000 -F auid!=unset -k module_chng
-a always,exit -F arch=b64 -S init_module -F auid>=1000 -F auid!=unset -k module_chng

# Capture all application initializations
# modify to reduce logs.
#-a always,exit -F arch=b32 -S execve -k app_init
#-a always,exit -F arch=b64 -S execve -k app_init
-a always,exit -F arch=b32 -S execve -F auid>=1000 -F auid!=unset -k app_init
-a always,exit -F arch=b64 -S execve -F auid>=1000 -F auid!=unset -k app_init

# Monitor file transfer commands
-a always,exit -F path=/bin/sftp -F auid>=1000 -F auid!=unset -k export
-a always,exit -F path=/bin/scp -F auid>=1000 -F auid!=unset -k export
-a always,exit -F path=/bin/dd -F auid>=1000 -F auid!=unset -k export
# removed. Excessive access. Not in disa stigs.
#-w /dev/ -p rw -k export
-w /mnt/ -p rw -k export

# Monitor print commands
-a always,exit -F path=/usr/sbin/lp -k print
-a always,exit -F path=/usr/sbin/lpr -k print
-a always,exit -F path=/usr/bin/enscript -k print

# Monitor security-related system configs (not already covered)
-w /etc/security/limits.conf -k secure
-w /etc/sssd/sssd.conf -p wa -k configuration_policy
-w /etc/sysconfig/authconfig -k secure
-w /etc/default -k secure
-w /etc/ftpusers -k secure
-w /etc/cron.allow -p wa -k CONF_CHANGE
-w /etc/cron.deny -p wa -k CONF_CHANGE
-w /etc/cron.d/ -p wa -k CONF_CHANGE
-w /etc/cron.daily/ -p wa -k CONF_CHANGE
-w /etc/cron.hourly/ -p wa -k CONF_CHANGE
-w /etc/cron.monthly/ -p wa -k CONF_CHANGE
-w /etc/cron.weekly/ -p wa -k CONF_CHANGE
-w /etc/crontab -p wa -k CONF_CHANGE
-w /var/spool/at/ -p wa -k CONF_CHANGE
-w /var/spool/cron/ -p wa -k CONF_CHANGE
-w /etc/sysconfig/init -p wa -k CONF_CHANGE
-w /etc/rc.d/init.d/ -p wa -k CONF_CHANGE
-w /etc/hosts -p wa -k CONF_CHANGE
-w /etc/sysconfig/network-scripts/ -p wa -k CONF_CHANGE
-w /etc/modprobe.conf -p wa -k CONF_CHANGE
-w /etc/at.allow -k secure
-w /etc/at.deny -k secure
-w /etc/ntp.conf -p wa -k configuration_policy

-w /var/lib/named -k dns
-w /etc/named.conf -k dns
-w /etc/sysconfig/named -k dns
-w /etc/name.d -k dns

-w /etc/pam_ldap.conf -k ldap
-w /etc/openldap/ldap.conf -k ldap
-w /etc/openldap/cacerts -k ldap

-w /etc/filebeat -k aaas
-w /usr/share/logstash -k aaas

# Audit Docker files and directories configs
-w /usr/bin/docker -k docker
# removed due to excessive hits
#-w /usr/bin/docker-containerd -k docker
#-w /usr/bin/docker-runc -k docker
-w /etc/default/docker -k docker
-w /etc/docker -k docker
-w /etc/docker/daemon.json -k docker
-w /usr/lib/systemd/system/docker.service -k docker
-w /usr/lib/systemd/system/docker.socket -k docker

